<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
	<select id="listSearch"  parameterType="com.company.spring.board.SearchCriteria" resultType="com.company.spring.board.BoardVO">
		SELECT R1.* FROM (
			SELECT bidx, btitle, bcontent, bdate, bcnt, m.mid, bvalue, (SELECT count(*) FROM reply_tb WHERE bidx=b.bidx) AS bcntNum
			FROM board_tb b, member_tb m
			where b.bwriter = m.mid
			<include refid="search"></include>
       		ORDER BY bidx desc
       	 	)R1 
            LIMIT #{rowStart},10
	</select>
	
	<select id="countSearch" resultType="int">
		SELECT count(bidx)
		FROM board_tb
		where bidx
	</select>
	
	<insert id="insert">
		INSERT INTO board_tb
			(btitle, bwriter, bcontent, bdate, bcnt, bvalue)
		VALUES (#{btitle}, #{bwriter}, #{bcontent}, now(), 0, 'y')	
	</insert>
	
	<select id="view" resultType="com.company.spring.board.BoardVO">
		SELECT *
		FROM board_tb
		WHERE bidx = #{bidx}
	</select>
	
	<update id="updateCnt">
		UPDATE board_tb
		SET bcnt = bcnt + 1
		WHERE bidx = #{bidx}
	</update>
	
	<select id="updateview" resultType="com.company.spring.board.BoardVO">
		SELECT *
		FROM board_tb
		WHERE bidx = #{bidx}
	</select>
	
	<update id="update">
		UPDATE board_tb 
		SET	btitle = #{btitle},
			bcontent = #{bcontent}
		WHERE bidx = #{bidx}	
	</update>
	
	<update id="delete">
		UPDATE board_tb
		SET bvalue = 'n' 
		WHERE bidx = #{bidx}
	</update>
	
	
	 <sql id="search">
		 <if test="searchType != null">
		  <if test="searchType == 't'.toString()">AND btitle like CONCAT("%" ,#{keyword} ,"%")</if>
		  <if test="searchType == 'c'.toString()">AND bcontent like CONCAT("%" ,#{keyword} ,"%")</if>
		  <if test="searchType == 'w'.toString()">AND bwriter = m.mid AND (m.mid like CONCAT("%" ,#{keyword} ,"%"))</if>
		 </if>
	 </sql>
</mapper>